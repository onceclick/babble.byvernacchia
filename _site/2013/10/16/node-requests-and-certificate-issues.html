<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>
		
			Node Requests and Certificate Issues | Babble by Vernacchia
		
	</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="index, follow" />
<meta name="revisit-after" content="14 days" />
<meta name="content-language" content="english" />
<meta name="robots" content="INDEX,FOLLOW" />

  <meta name="description" content="I was recently doing some work integrating Strider with a Github Enterprise Server (GHE). I thought it was going to be pretty easy, and boy was I wrong. I was greeted by this awesome error message ...">


<meta name="keywords" content="technology, javascript, blogging, web development, programming, babble" />

	<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />

	<meta property="og:title" content="Node Requests and Certificate Issues" />


	<meta property="og:url" content="http://babble.byvernacchia.com" />






	<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@vernacchia" />
<meta name="twitter:creator" content="@vernacchia" />

  <meta name="twitter:title" content="Node Requests and Certificate Issues" />


  <meta name="twitter:url" content="http://babble.byvernacchia.com/2013/10/16/node-requests-and-certificate-issues.html" />


  <meta name="twitter:description" content="I was recently doing some work integrating Strider with a Github Enterprise Server (GHE). I thought it was going to be pretty easy, and boy was I wrong. I was greeted by this awesome error message ..." />


	<!-- bootstrap styles -->
	<link rel="stylesheet" href="/css/bootstrap.css">

	<!-- Custom CSS -->
	<link rel="stylesheet" href="/css/styles.css">
</head>
<body>
	<div class="site-search-container">
		<form action="/search/" method="get" class="search-form">
			<input class="custom-input" id="query" type="text" name="q" placeholder="Search...">
		</form>
		<div class="search-toggle" id="js-search-toggle">Search</div>
	</div> 

	<div class="container">
		<div class="row-fluid">
			<div class="span12">&nbsp;</div>
		</div>
		<div class="row-fluid">
			<div class="span9">
				<div class="span12 post">
					<p><a href="/">go back home...</a></p>
					<h1 class="site-title">Node Requests and Certificate Issues</h1>
					<p class="post-meta">October 16, 2013 at 08:25 AM</p>
					<p><p><em>I searched high and low for a solution to this. Every post I found was so technical about it, so hopefully this makes it easier to understand.</em></p>

<p>I was recently doing some work integrating <a href="http://stridercd.com/">Strider</a> with a Github Enterprise Server (GHE). I thought it was going to be pretty easy, and boy was I wrong.</p>

<p>I started by modifying the node module that the Strider team created to integrate with Github.com. I thought, "These two are basically the same thing, should be easy to handle". After integrating the configuration options to specify a GHE server, I was ready to test.</p>

<p>I boot up Strider and there's the start page. I login; it works. Everything's going so well. I try to authenticate with our GHE server and see the oAuth page with everything Strider wants to access. Perfect. I click the authenticate button, and am redirect back to my app. Here's where things start to fall apart.</p>

<p>I'm greeted by this awesome error message <code>UNABLE_TO_VERIFY_LEAF_SIGNATURE</code>, and I'm thinking to myself, "WTF!! This works with github.com and the GHE is a copy of that."</p>

<p>After a few hours of messing around, looking for others who've had this problem, and getting frustrated I asked one of my co-workers. Turns out he was doing something else and ran into this problem.</p>

<p>It turns out that our SSL Certificate Chain was not set up correctly. When node makes requests using the https module (<code>require('https')</code>) it automatically inspects the certificate chain. If there's a problem, it will throw this error.</p>

<p>Our problem was that we have a root certificate, intermediary certificate, and then the wildcard certificate for our GHE. Turns out the wildcard certificate wasn't linked to the root. And there you have it.</p>

<p><strong>In this post I talk about GHE integration and Strider, but not the outcome. I will have a post about that soon.</strong></p>

<p>Heres a full version of my lovely error message:</p>

<pre><code>500 failed to obtain access token (Error: UNABLE_TO_VERIFY_LEAF_SIGNATURE)
  at /project/node_modules/passport-github/node_modules/passport-oauth/lib/passport-oauth/strategies/oauth2.js:125:38
  at /project/node_modules/passport-github/node_modules/passport-oauth/node_modules/oauth/lib/oauth2.js:160:18
  at ClientRequest. (/project/node_modules/passport-github/node_modules/passport-oauth/node_modules/oauth/lib/oauth2.js:129:5)
  at ClientRequest.EventEmitter.emit (events.js:95:17)
  at CleartextStream.socketErrorListener (http.js:1548:9)
  at CleartextStream.EventEmitter.emit (events.js:95:17)
  at SecurePair. (tls.js:1375:19)
  at SecurePair.EventEmitter.emit (events.js:92:17)
  at SecurePair.maybeInitFinished (tls.js:968:10)
  at CleartextStream.read [as _read] (tls.js:462:15)
</code></pre>

<h3>Workaround</h3>

<p>I found a workaround for this problem, but it is a potential security risk. <strong>USE AT YOUR OWN RISK</strong>.</p>

<p>To work around this you'll need to set <code>rejectUnauthorized = false</code> on whatever is handling your requests. You can usually pass it in with the headers (options) and you should be fine. Again, use at your own risk.</p>
</p>
					<div class="tag-container">
						<strong>Tags:&nbsp;</strong>
						
							<a href="/tags/nodejs" class="post-tag" title="View posts tagged with &quot;nodejs&quot;">
								nodejs<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/javascript" class="post-tag" title="View posts tagged with &quot;javascript&quot;">
								javascript<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/certificate-issues" class="post-tag" title="View posts tagged with &quot;certificate-issues&quot;">
								certificate-issues<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/strider" class="post-tag" title="View posts tagged with &quot;strider&quot;">
								strider<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/github-enterprise" class="post-tag" title="View posts tagged with &quot;github-enterprise&quot;">
								github-enterprise
							</a>
							
						
					</div>	
				</div>
			</div>
			<div class="span3 pad-bottom">
				<div class="span12"><h1>&nbsp;</h1></div>
				<div class="span12" style="margin-left:0 !important;">
					<div class="bio-image"></div>
<div class="bio-desc txt-center">
	<p>I am a life-long learner, adventure seeker, and front-end developer for <a href="https://twitter.com/ExactTarget" target="_blank">@ExactTarget</a></p>
</div>
<ul class="social clearfix">
	<li class="linkedin"><a href="http://www.linkedin.com/in/alexvernacchia/" target="_blank"></a></li>
	<li class="twitter"><a href="https://twitter.com/vernacchia" target="_blank"></a></li>
	<li class="github"><a href="https://github.com/vernak2539" target="_blank"></a></li>
	<li class="about-me"><a href="http://about.me/vernacchia" target="_blank"></a></li>
</ul>
<div class="repo-btn-container">
	<a href="https://github.com/vernak2539/babble.byvernacchia" class="btn btn-info btn-large" target="_blank">This Site's Repo</a>
</div>
				</div>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">&nbsp;</div>
		</div>
		<div id="disqus_thread" class="row-fluid"></div>
	</div>
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = ''; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		/*(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();*/
	</script>

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-XXXX-X', 'yourSiteHere.com');
		ga('send', 'pageview');
	</script>
	<script type="text/javascript" src="/js/min/jquery.js"></script>
	<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/js/min/all.js" async></script>
</body>
</html>
 