<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>
		
			Apache and MySQL sucking up all the memory | Babble by Vernacchia
		
	</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="index, follow" />
<meta name="revisit-after" content="14 days" />
<meta name="content-language" content="english" />
<meta name="robots" content="INDEX,FOLLOW" />

  <meta name="description" content="Yesterday I was trying to do some work on the server I host my projects on. After it being super sluggish, to say the least, I started to investigate why">


<meta name="keywords" content="technology, javascript, blogging, web development, programming, babble" />

	<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />

	<meta property="og:title" content="Apache and MySQL sucking up all the memory" />


	<meta property="og:url" content="http://babble.byvernacchia.com" />






	<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@vernacchia" />
<meta name="twitter:creator" content="@vernacchia" />

  <meta name="twitter:title" content="Apache and MySQL sucking up all the memory" />


  <meta name="twitter:url" content="http://babble.byvernacchia.com/2013/04/01/apache-and-mysql-sucking-up-all-the-memory.html" />


  <meta name="twitter:description" content="Yesterday I was trying to do some work on the server I host my projects on. After it being super sluggish, to say the least, I started to investigate why" />


	<!-- bootstrap styles -->
	<link rel="stylesheet" href="/css/bootstrap.css">

	<!-- Custom CSS -->
	<link rel="stylesheet" href="/css/styles.css">
</head>
<body>
	<div class="site-search-container">
		<form action="/search/" method="get" class="search-form">
			<input class="custom-input" id="query" type="text" name="q" placeholder="Search...">
		</form>
		<div class="search-toggle" id="js-search-toggle">Search</div>
	</div> 

	<div class="container">
		<div class="row-fluid">
			<div class="span12">&nbsp;</div>
		</div>
		<div class="row-fluid">
			<div class="span9">
				<div class="span12 post">
					<p><a href="/">go back home...</a></p>
					<h1 class="site-title">Apache and MySQL sucking up all the memory</h1>
					<p class="post-meta">April 01, 2013 at 09:24 AM</p>
					<p><p>Yesterday I was trying to do some work on the server I host my projects on. After it being super sluggish, to say the least, I started to investigate why.</p>

<p><strong>NOTE:</strong> I am not a SysAdmin and do not have a lot of details on the inner workings of everything in this post. These are just genearl things that worked for me and my set up. I use a Linux box, PHP, Apache, and MySQL in most of my set up. So I <strong>insist</strong> that you do your research before doing anything haphazardly.</p>

<h3>MySQL</h3>

<p>The first thing I found was that mysql (mysqld) was taking up huge amounts of memory (RES). So I dived into this first. I started by googling what could be done, and found <a href="http://www.howtoforge.com/tuning-mysql-performance-with-mysqltuner">an article</a> about tuning MySQL performance. I ran the perl file and found out that I had some issues.</p>

<ol>
<li> My tables weren’t optimized</li>
<li> I didn’t have my max connections set</li>
<li> My table cache was too high</li>
<li> My ratio of query cache size to query cache limit was off</li>
</ol>


<p>To remedy this I took a look at a post on stack overflow (which I can’t find again, damn), where the person had a configuration that was pretty close to mine. After making some changes to the mysql <code>my.cnf</code> file and optimizing my tables, I restarted MySQL and waited 24 hours.</p>

<p>WOW, what a change. I saw a significant drop in memory usage, but will continue to monitor it as it can be fine tuned even more. On to the next one.</p>

<h3>Apache</h3>

<p>Apache seemed to be my next culprit. There were a lot of concurrent processes averaging around 50M each. Gigantic waste of memory, let me tell you. <a href="http://serverfault.com/questions/383526/how-do-i-select-which-apache-mpm-to-use">After investigating my options</a>, it looked like I was going to switch from the prefork configuration to the worker configuration. Something about threaded processes and everything.</p>

<p>But with this configuration, PHP is unable to do threading by default with apache, or something like that. After looking around I found <a href="http://ubuntuforums.org/showthread.php?t=1038416">an article</a> that went through the process step by step to enable PHP use with mpm_worker. It was actually painless, and boy did this cut down on the memory apache was using. Like DAMN, that’s a huge improvement. I would recommend taking a look at doing that.</p>

<h3>WordPress</h3>

<p>My blog is ran on WordPress 3, and that in itself is a huge memory waster (WordPress that is). After digging into some things that could increase WordPress’ performance I found that permalink structure can affect the loading of your blog.</p>

<p>The error lies in the <code>rewrite.php</code> file or so I’m told, but I changed my permalink structure to include the post id, which made my posts easier to retrieve by the WordPress engine. Boy do I hate wordpress, but I just don’t have time to switch over.</p>

<p>Right now I don’t cache anything in WordPress either, but I will be looking into that for sure.</p>

<h3>The End</h3>

<p>So those were some of my problems. Remember, I just manage my own server and do not have a super in-depth knowledge of this performance stuff. I’m doing what works out for me. Research before you think of trying these things out.</p>
</p>
					<div class="tag-container">
						<strong>Tags:&nbsp;</strong>
						
							<a href="/tags/web-development" class="post-tag" title="View posts tagged with &quot;web-development&quot;">
								web-development<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/apache" class="post-tag" title="View posts tagged with &quot;apache&quot;">
								apache<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/linux" class="post-tag" title="View posts tagged with &quot;linux&quot;">
								linux<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/mpm_worker" class="post-tag" title="View posts tagged with &quot;mpm_worker&quot;">
								mpm_worker<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/mysql" class="post-tag" title="View posts tagged with &quot;mysql&quot;">
								mysql<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/sysadmin" class="post-tag" title="View posts tagged with &quot;sysadmin&quot;">
								sysadmin<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/threading" class="post-tag" title="View posts tagged with &quot;threading&quot;">
								threading<span class="comma">,&nbsp;</span>
							</a>
							
							
						
							<a href="/tags/wordpress" class="post-tag" title="View posts tagged with &quot;wordpress&quot;">
								wordpress
							</a>
							
						
					</div>	
				</div>
			</div>
			<div class="span3 pad-bottom">
				<div class="span12"><h1>&nbsp;</h1></div>
				<div class="span12" style="margin-left:0 !important;">
					<div class="bio-image"></div>
<div class="bio-desc txt-center">
	<p>I am a life-long learner, adventure seeker, and front-end developer for <a href="https://twitter.com/ExactTarget" target="_blank">@ExactTarget</a></p>
</div>
<ul class="social clearfix">
	<li class="linkedin"><a href="http://www.linkedin.com/in/alexvernacchia/" target="_blank"></a></li>
	<li class="twitter"><a href="https://twitter.com/vernacchia" target="_blank"></a></li>
	<li class="github"><a href="https://github.com/vernak2539" target="_blank"></a></li>
	<li class="about-me"><a href="http://about.me/vernacchia" target="_blank"></a></li>
</ul>
<div class="repo-btn-container">
	<a href="https://github.com/vernak2539/babble.byvernacchia" class="btn btn-info btn-large" target="_blank">This Site's Repo</a>
</div>
				</div>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span12">&nbsp;</div>
		</div>
		<div id="disqus_thread" class="row-fluid"></div>
	</div>
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = ''; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		/*(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();*/
	</script>

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-XXXX-X', 'yourSiteHere.com');
		ga('send', 'pageview');
	</script>
	<script type="text/javascript" src="/js/min/jquery.js"></script>
	<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/js/min/all.js" async></script>
</body>
</html>
 